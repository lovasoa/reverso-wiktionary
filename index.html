<html>
  <head>
    <meta charset="utf-8">
    <link rel="icon" type="image/svg+xml" sizes="any" href="logo.svg">
    <link rel="icon" type="image/png" sizes="64x64" href="logo.png">
    <title>Reverso-Wiktionary</title>
    <style>
input {
  font-size: 1.5em;
  width: 99%;
}
iframe {
  width: 49%;
  height: 100%;
  border: 1px solid grey;
  display: inline-block;
}
    </style>
  </head>

  <body>
    <form id="form" action="">
      <input id="search" type="search" name="s" autofocus placeholder="Chercher un mot en russe" list="props"/>
      <datalist id="props"></datalist>
    </form>

    <iframe id="wt" src=""></iframe>
    <iframe id="r"  src=""></iframe>
    
    <script>
var input = document.getElementById("search");
var form = document.getElementById("form");
var props = document.getElementById("props");
var iframe1 = document.getElementById("wt");
var iframe2 = document.getElementById("r");
form.onsubmit = function(evt) {
 evt.preventDefault();
 search(input.value);
 if (window.history) history.pushState(input.value, input.value, "index.html?s="+input.value);
 return false;
}

function search(value) {
   var s = (value);
   document.title = "Reverso-Wiktionary: " + s;
   input.value = s;
   iframe1.src = "https://en.wiktionary.org/wiki/"+s+"#Russian"; 
   iframe2.src = "http://context.reverso.net/translation/russian-french/"+s+"#translations"; 
}

input.onkeyup = function(e) {
  if(e.keyCode === 13) {
    search(input.value);
    showSuggestions(false);
  }
  else {
    autocompleteRequest(input.value);
  }
}

var last_search = "", suggestions = false;
function autocompleteRequest(s) {
  if (s === last_search) return;
  last_search = s;
  showSuggestions(true);
  var script = document.createElement("script");
  script.src = "https://en.wiktionary.org/w/api.php?action=opensearch&format=json&formatversion=2&callback=updateOptions&search="+encodeURIComponent(s);
  document.body.appendChild(script);
}

function updateOptions(res) {
  if (!suggestions) return;
  props.innerHTML = "";
  res[1].forEach(function(prop) {
    var opt = document.createElement("option");
    opt.value = prop;
    props.appendChild(opt);
  });
}

function showSuggestions(show) {
  suggestions = show;
  if (suggestions === false) props.innerHTML = "";
}

var m = window.location.search.match(/\?s=([^&]*)/);
if (m) search(decodeURIComponent(m[1]));
    </script>
  </body>
</html>
